stages:
    - test
    
before_script:
    - apt-get update
    - apt-get -y install
        cmake
        gobjc
        gobjc++
        libtiff-dev
        liblcms2-dev
        libgnustep-base-dev
        libgsl-dev
        libopenexr-dev

# linux:
#     stage: build
#     script:
#         - apt-get update
#         - apt-get -y install
#             cmake
#             gobjc
#             gobjc++
#             libtiff-dev
#             liblcms2-dev
#             libgnustep-base-dev
#             libgsl-dev
#             libopenexr-dev
#         - mkdir build
#         - cd build
#         - cmake ..
#         - make
#     artifacts:
#         paths:
#             - build
#     tags:
#         - linux

render:
    stage: test
#    needs: ["linux"]
    script:
        - export PATH=${PATH}:/usr/local/bin
        - export LD_LIBRARY_PATH=${LD_LIBRARY_PATH}:/usr/local/lib
        - export ART_LIBRARY_PATH=/usr/local/lib
        - export ART_RESOURCE_PATH=${ART_LIBRARY_PATH}/ART_Resources
        - mkdir build
        - cd build
        - cmake ..
        - make install
        - cd ..
        - git clone https://gitlab.com/art-development-team/art-functionality-test.git
        - cd art-functionality-test
        - git checkout v2.1
        - python art_functionality_test.py
        - mv reference ..
        - mv output ..
        - cd ..
        - cd reference
        - rm *.artcsp *.artraw *.tiff
	- cd ..
        - if [ $(cat output/report/success) = 'FALSE' ]; then exit 1; fi
    artifacts:
        when: always
        paths:
            - output
            - reference
        reports:
            junit: output/report/junit.xml
    tags:
        - linux
